<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journey Planner - åˆ†äº«çš„è¡Œç¨‹</title>
    
    <!-- Open Graph meta tags for iMessage/LINE preview cards -->
    <meta property="og:title" content="ğŸ—ºï¸ Journey Planner è¡Œç¨‹åˆ†äº«">
    <meta property="og:description" content="é»æ“ŠæŸ¥çœ‹ç²¾å¿ƒè¦åŠƒçš„æ—…éŠè¡Œç¨‹ï¼">
    <meta property="og:image" content="https://stevyee.github.io/journey-planner-share/preview.png">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 24px;
            padding: 40px 32px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0,0,0,0.35);
        }
        .logo { font-size: 72px; margin-bottom: 16px; }
        h1 { color: #333; margin-bottom: 8px; font-size: 24px; }
        .subtitle { color: #888; margin-bottom: 24px; font-size: 14px; }
        .status { 
            padding: 16px; 
            border-radius: 12px; 
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.5;
        }
        .status.loading { background: #e3f2fd; color: #1565c0; }
        .status.success { background: #e8f5e9; color: #2e7d32; }
        .status.fallback { background: #fff3e0; color: #e65100; }
        .status.error { background: #ffebee; color: #c62828; }
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 32px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 600;
            font-size: 16px;
            margin: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(102,126,234,0.4); }
        .contact { 
            margin-top: 28px; 
            padding: 20px; 
            background: #fafafa; 
            border-radius: 16px;
            border: 1px solid #eee;
        }
        .contact h3 { color: #333; margin-bottom: 8px; font-size: 16px; }
        .contact p { color: #666; margin: 0; font-size: 14px; line-height: 1.5; }
        .footer { margin-top: 24px; color: #aaa; font-size: 12px; }
        #itinerary-preview { 
            background: #f8f9fa; 
            border-radius: 12px; 
            padding: 16px; 
            margin-bottom: 20px; 
            text-align: left;
            display: none;
        }
        #itinerary-preview h2 { font-size: 18px; color: #333; margin-bottom: 8px; }
        #itinerary-preview p { font-size: 14px; color: #666; line-height: 1.5; }
        .debug { font-size: 10px; color: #999; margin-top: 16px; word-break: break-all; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ğŸ—ºï¸</div>
        <h1>Journey Planner</h1>
        <p class="subtitle">AI æ—…éŠè¡Œç¨‹è¦åŠƒ</p>
        
        <div id="itinerary-preview"></div>
        
        <div id="status" class="status loading">
            â³ æ­£åœ¨è¼‰å…¥è¡Œç¨‹è³‡æ–™...
        </div>
        
        <a href="#" id="openAppBtn" class="btn" style="display:none;">ğŸ“± åœ¨ App ä¸­é–‹å•Ÿ</a>
        
        <div class="contact">
            <h3>ğŸ“§ éœ€è¦å–å¾— Appï¼Ÿ</h3>
            <p>Journey Planner ç›®å‰ç‚ºç§äººæ¸¬è©¦ç‰ˆæœ¬<br>è«‹è¯ç¹« <strong>Steven</strong> å–å¾—å®‰è£æ–¹å¼</p>
        </div>
        
        <p class="footer">Â© 2024 Journey Planner by Steven</p>
        
        <div id="debug" class="debug"></div>
    </div>
    
    <script>
        // Debug info
        var debugEl = document.getElementById('debug');
        var statusEl = document.getElementById('status');
        var openAppBtn = document.getElementById('openAppBtn');
        var previewEl = document.getElementById('itinerary-preview');
        
        // Get full URL for debugging
        debugEl.textContent = 'URL: ' + window.location.href.substring(0, 100) + '...';
        
        // Parse URL parameters
        var urlParams = new URLSearchParams(window.location.search);
        var data = urlParams.get('data');
        
        console.log('Full URL:', window.location.href);
        console.log('Data parameter exists:', !!data);
        console.log('Data length:', data ? data.length : 0);
        
        if (data && data.length > 10) {
            // We have data - show the button and try to parse
            openAppBtn.style.display = 'inline-block';
            
            // Build the app URL
            var appURL = 'journeyplanner://itinerary?data=' + data;
            openAppBtn.href = appURL;
            
            debugEl.textContent = 'Data length: ' + data.length + ' chars';
            
            // Try to decode and show preview
            try {
                // URL-safe base64 decode
                var base64 = data.replace(/-/g, '+').replace(/_/g, '/');
                while (base64.length % 4) {
                    base64 += '=';
                }
                var json = atob(base64);
                var itinerary = JSON.parse(json);
                
                if (itinerary.title) {
                    previewEl.style.display = 'block';
                    previewEl.innerHTML = 
                        '<h2>ğŸ“ ' + itinerary.title + '</h2>' +
                        '<p>' + (itinerary.summary || '').substring(0, 150) + '...</p>' +
                        '<p style="margin-top: 8px; color: #667eea;">ğŸ“… ' + 
                        (itinerary.days ? itinerary.days.length : 0) + ' å¤©è¡Œç¨‹</p>';
                    
                    statusEl.className = 'status success';
                    statusEl.innerHTML = 'âœ… è¡Œç¨‹è¼‰å…¥æˆåŠŸï¼<br>é»æ“Šä¸‹æ–¹æŒ‰éˆ•åœ¨ App ä¸­æŸ¥çœ‹';
                }
            } catch (e) {
                console.log('Parse error:', e);
                statusEl.className = 'status fallback';
                statusEl.innerHTML = 'âš ï¸ ç„¡æ³•è§£æè¡Œç¨‹é è¦½<br>ä½†ä»å¯å˜—è©¦åœ¨ App ä¸­é–‹å•Ÿ';
            }
            
            // Auto-open app after a short delay
            setTimeout(function() {
                console.log('Attempting to open app:', appURL.substring(0, 80));
                window.location.href = appURL;
            }, 1000);
            
        } else {
            // No data parameter
            statusEl.className = 'status error';
            statusEl.innerHTML = 'âŒ é€£çµç„¡æ•ˆï¼šç¼ºå°‘è¡Œç¨‹è³‡æ–™<br><small>è«‹ç¢ºèªé€£çµæ˜¯å¦å®Œæ•´</small>';
            openAppBtn.style.display = 'none';
            
            debugEl.textContent = 'No data parameter found. Search: ' + window.location.search.substring(0, 50);
        }
    </script>
</body>
</html>
